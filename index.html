<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>WELLTIME ‚Äì Te Whare Tapa WhƒÅ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Tailwind via CDN so we can reuse your classes -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
  <div id="app"></div>

  <script>
    // ---------- STATE ----------
    const state = {
      currentPage: 'welcome',
      userEmail: '',
      hasSeenWelcome: false,
      completedChallenges: {},        // for current set
      dailyChallenges: [],
      savedSetProgress: {},           // { setNum: {challenges, completed} }
      currentChallengeNumber: null,
      completedChallengeNumbers: [],  // list of completed set numbers
      totalSets: 12,
      totalTasksCompleted: 0,
      dailyProgress: {},              // { dateString: {sets, tasks} }
      calendarMonth: new Date().getMonth(),
      calendarYear: new Date().getFullYear(),
      pixelArtCoords: {
        darkPink: '',
        lightPink: '',
        black: '',
        validAnswers: []
      }
    };

    // ---------- DATA ----------
    const allChallenges = [
      // Taha Tinana (Physical Wellbeing)
      'Go for a 20-minute walk or run',
      'Drink 6-8 glasses of water today',
      'Get 8+ hours of sleep tonight',
      'Eat at least 3 servings of vegetables',
      'Do 15 minutes of stretching or exercise',
      'Play a sport or active game',
      'Take the stairs instead of the elevator',

      // Taha Hinengaro (Mental & Emotional Wellbeing)
      "Write down 3 things you're grateful for",
      'Spend 10 minutes doing something creative',
      'Take 5 deep breaths when feeling stressed',
      "Talk to someone about how you're feeling",
      'Do an activity you enjoy for 30 minutes',
      'Listen to your favorite music',
      'Read a book or article for pleasure',

      // Taha WhƒÅnau (Family & Social Wellbeing)
      'Have a meaningful conversation with family/whƒÅnau',
      'Help someone with a task without being asked',
      "Send a message to a friend you haven't talked to recently",
      'Share a meal with family or friends',
      'Say something kind to someone today',
      'Call or video chat with someone you care about',
      'Give someone a genuine compliment',

      // Taha Wairua (Spiritual Wellbeing)
      'Spend 10 minutes in nature',
      'Think about your values and what matters to you',
      'Do something that connects you to your culture or identity',
      'Practice mindfulness or meditation for 5 minutes',
      "Reflect on something you're proud of this week",
      'Write in a journal about your thoughts',
      'Watch a sunrise or sunset'
    ];

    // ---------- HELPERS ----------
    function generateDailyChallenges() {
      const shuffled = [...allChallenges].sort(() => Math.random() - 0.5);
      return shuffled.slice(0, 5);
    }

    function generatePixelArtCoordinates() {
      const darkPinkCoords = [
        'A2', 'A3', 'A4', 'A5', 'A9', 'A10', 'A11', 'A12',
        'B1', 'B6', 'B8', 'B11', 'B13',
        'C1', 'C7', 'C10', 'C14',
        'D2', 'D3', 'D4', 'D5', 'D9', 'D14',
        'E6', 'E9', 'E14',
        'F6', 'F9', 'F14',
        'G6', 'G9', 'G14',
        'H2', 'H3', 'H4', 'H5', 'H9', 'H14',
        'I1', 'I7', 'I10', 'I14',
        'J1', 'J6', 'J8', 'J11', 'J13',
        'K2', 'K3', 'K4', 'K5', 'K9', 'K10', 'K11', 'K12'
      ];
      const lightPinkCoords = [
        'B2', 'B3', 'B4', 'B5', 'B9', 'B10',
        'C2', 'C3', 'C4', 'C5', 'C6', 'C8', 'C9',
        'D6', 'D7', 'D8',
        'E7', 'E8',
        'F7', 'F8',
        'G7', 'G8',
        'H6', 'H7', 'H8',
        'I2', 'I3', 'I4', 'I5', 'I6', 'I8', 'I9',
        'J2', 'J3', 'J4', 'J5', 'J9', 'J10',
        'K6', 'K7', 'K8', 'K9', 'K10'
      ];
      const blackCoords = ['D11', 'D12', 'F12', 'H11', 'H12'];

      const shuffle = arr => [...arr].sort(() => Math.random() - 0.5);

      return {
        darkPink: shuffle(darkPinkCoords).join(', '),
        lightPink: shuffle(lightPinkCoords).join(', '),
        black: shuffle(blackCoords).join(', '),
        validAnswers: ['bunny', 'rabbit', 'labubu']
      };
    }

    function getTotalCompleted() {
      return Object.values(state.completedChallenges).filter(Boolean).length;
    }

    function goToPage(page) {
      state.currentPage = page;
      render();
    }

    // ---------- ACTIONS ----------
    function saveEmailAndContinue() {
      const emailInput = document.getElementById('emailInput');
      if (emailInput && emailInput.value.trim()) {
        state.userEmail = emailInput.value.trim();
      }
      state.hasSeenWelcome = true;
      state.currentPage = 'home';
      render();
    }

    function skipEmailAndContinue() {
      state.hasSeenWelcome = true;
      state.currentPage = 'home';
      render();
    }

    function startChallenge(setNum) {
      state.currentChallengeNumber = setNum;

      if (state.savedSetProgress[setNum]) {
        state.dailyChallenges = state.savedSetProgress[setNum].challenges;
        state.completedChallenges = { ...state.savedSetProgress[setNum].completed };
      } else {
        const newChals = generateDailyChallenges();
        state.dailyChallenges = newChals;
        state.completedChallenges = {};
        state.savedSetProgress[setNum] = {
          challenges: newChals,
          completed: {}
        };
      }

      state.currentPage = 'challenges';
      render();
    }

    function toggleChallenge(index) {
      state.completedChallenges[index] = !state.completedChallenges[index];

      const current = state.currentChallengeNumber;
      state.savedSetProgress[current] = {
        challenges: state.dailyChallenges,
        completed: { ...state.completedChallenges }
      };

      render();
    }

    function goToPhotoPage() {
      state.pixelArtCoords = generatePixelArtCoordinates();
      state.currentPage = 'photo';
      render();
    }

    function completeSetFromPhoto() {
      const input = document.getElementById('userWord');
      const answer = (input?.value || '').trim().toLowerCase();

      if (!state.pixelArtCoords.validAnswers.includes(answer)) {
        const msg = document.getElementById('wordFeedback');
        if (msg) {
          msg.textContent = 'Not quite right, try again!';
          msg.className = 'text-red-500 text-sm mt-2';
        }
        return;
      }

      // mark set completed
      const current = state.currentChallengeNumber;
      if (current && !state.completedChallengeNumbers.includes(current)) {
        state.completedChallengeNumbers.push(current);
        state.totalTasksCompleted += 5;

        // daily progress
        const today = new Date().toDateString();
        const prev = state.dailyProgress[today] || { sets: 0, tasks: 0 };
        state.dailyProgress[today] = {
          sets: prev.sets + 1,
          tasks: prev.tasks + 5
        };

        // remove saved progress for that set
        delete state.savedSetProgress[current];
      }

      state.currentPage = 'challengeList';
      render();
    }

    function goToPreviousMonth() {
      if (state.calendarMonth === 0) {
        state.calendarMonth = 11;
        state.calendarYear -= 1;
      } else {
        state.calendarMonth -= 1;
      }
      render();
    }

    function goToNextMonth() {
      if (state.calendarMonth === 11) {
        state.calendarMonth = 0;
        state.calendarYear += 1;
      } else {
        state.calendarMonth += 1;
      }
      render();
    }

    function goToToday() {
      const today = new Date();
      state.calendarMonth = today.getMonth();
      state.calendarYear = today.getFullYear();
      render();
    }

    // ---------- RENDER ----------
    function renderNavigationBar() {
      return `
        <div class="fixed bottom-0 left-0 right-0 bg-white border-t-2 shadow-lg z-50" style="border-color:#E0B0D5">
          <div class="flex justify-around items-center py-3 max-w-md mx-auto">
            <button onclick="goToPage('home')" class="flex flex-col items-center gap-1 px-3 py-2 rounded-lg ${state.currentPage==='home' ? '' : 'text-gray-500'}" style="${state.currentPage==='home' ? 'color:#7DCE82' : ''}">
              <span class="text-xl">üè†</span>
              <span class="text-xs font-semibold">Home</span>
            </button>
            <button onclick="goToPage('challengeList')" class="flex flex-col items-center gap-1 px-3 py-2 rounded-lg ${state.currentPage==='challengeList' ? '' : 'text-gray-500'}" style="${state.currentPage==='challengeList' ? 'color:#7DBFF8' : ''}">
              <span class="text-xl">üóÇÔ∏è</span>
              <span class="text-xs font-semibold">Sets</span>
            </button>
            <button onclick="goToPage('stats')" class="flex flex-col items-center gap-1 px-3 py-2 rounded-lg ${state.currentPage==='stats' ? '' : 'text-gray-500'}" style="${state.currentPage==='stats' ? 'color:#E0B0D5' : ''}">
              <span class="text-xl">üèÖ</span>
              <span class="text-xs font-semibold">Stats</span>
            </button>
            <button onclick="goToPage('calendar')" class="flex flex-col items-center gap-1 px-3 py-2 rounded-lg ${state.currentPage==='calendar' ? '' : 'text-gray-500'}" style="${state.currentPage==='calendar' ? 'color:#FFD07B' : ''}">
              <span class="text-xl">üìÖ</span>
              <span class="text-xs font-semibold">Calendar</span>
            </button>
          </div>
        </div>
      `;
    }

    function render() {
      const app = document.getElementById('app');
      let html = '';

      // WELCOME
      if (state.currentPage === 'welcome' && !state.hasSeenWelcome) {
        html = `
          <div class="min-h-screen bg-gradient-to-br from-blue-50 via-pink-50 to-purple-50 flex items-center justify-center px-4">
            <div class="max-w-md w-full">
              <div class="text-center mb-8">
                <h1 class="text-5xl md:text-6xl font-serif mb-3 text-black" style="font-family:Georgia,serif;letter-spacing:0.1em">WELLTIME</h1>
                <p class="text-sm md:text-base italic text-black mb-6" style="font-family:Georgia,serif">Your journey to a balanced year</p>
              </div>
              <div class="bg-white rounded-3xl shadow-xl p-8">
                <h2 class="text-2xl font-bold text-black mb-4">Welcome!</h2>
                <p class="text-gray-700 mb-6">
                  Save your progress by entering your email. This allows you to access your journey from any device.
                </p>
                <div class="mb-6">
                  <label class="block text-sm font-semibold text-gray-700 mb-2">Email Address (Optional)</label>
                  <input id="emailInput" type="email" placeholder="your.email@example.com"
                         class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-purple-400 transition-all" />
                </div>
                <div class="space-y-3">
                  <button onclick="saveEmailAndContinue()" class="w-full py-3 rounded-full text-lg font-bold text-white shadow-lg hover:scale-105 transition-all"
                          style="background:linear-gradient(135deg,#7DCE82 0%,#7DBFF8 100%)">
                    Save & Continue
                  </button>
                  <button onclick="skipEmailAndContinue()"
                          class="w-full py-3 rounded-full text-lg font-semibold border-2 transition-all hover:bg-gray-50"
                          style="border-color:#E0B0D5;color:#E0B0D5">
                    Skip for Now
                  </button>
                </div>
              </div>
            </div>
          </div>
        `;
        app.innerHTML = html;
        return;
      }

      // HOME
      if (state.currentPage === 'home') {
        html = `
          <div class="min-h-screen bg-gradient-to-br from-blue-50 via-pink-50 to-purple-50 pb-20">
            <div class="max-w-4xl mx-auto px-4 py-4 md:py-8">
              <div class="text-center mb-6 md:mb-8">
                <h1 class="text-4xl md:text-6xl font-serif mb-2 text-black" style="font-family:Georgia,serif;letter-spacing:0.1em">WELLTIME</h1>
                <p class="text-xs md:text-sm italic text-black mb-4 md:mb-6" style="font-family:Georgia,serif">Your journey to a balanced year</p>
              </div>
              <div class="text-center mb-6 md:mb-8">
                <h2 class="text-xl md:text-2xl font-bold text-black mb-2 md:mb-4">Welcome to Te Whare Tapa WhƒÅ</h2>
                <p class="text-base md:text-lg text-black max-w-2xl mx-auto px-2">
                  Balance your wellbeing across the four pillars of health. Complete daily challenges and express yourself through color!
                </p>
              </div>
              <div class="bg-white rounded-3xl shadow-xl p-4 md:p-8 mb-6 md:mb-8">
                <h3 class="text-xl md:text-2xl font-bold text-black mb-3 md:mb-4">The Four Pillars</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4">
                  <div class="p-3 md:p-4 rounded-xl border-2" style="background-color:#E8F7F0;border-color:#7DCE82">
                    <h4 class="font-bold mb-1 text-black text-sm md:text-base">Taha Tinana</h4>
                    <p class="text-xs md:text-sm text-black">Physical Wellbeing</p>
                  </div>
                  <div class="p-3 md:p-4 rounded-xl border-2" style="background-color:#E8F5FD;border-color:#7DBFF8">
                    <h4 class="font-bold mb-1 text-black text-sm md:text-base">Taha Hinengaro</h4>
                    <p class="text-xs md:text-sm text-black">Mental & Emotional Wellbeing</p>
                  </div>
                  <div class="p-3 md:p-4 rounded-xl border-2" style="background-color:#F8EBF5;border-color:#E0B0D5">
                    <h4 class="font-bold mb-1 text-black text-sm md:text-base">Taha WhƒÅnau</h4>
                    <p class="text-xs md:text-sm text-black">Family & Social Wellbeing</p>
                  </div>
                  <div class="p-3 md:p-4 rounded-xl border-2" style="background-color:#FFF8E8;border-color:#FFD07B">
                    <h4 class="font-bold mb-1 text-black text-sm md:text-base">Taha Wairua</h4>
                    <p class="text-xs md:text-sm text-black">Spiritual Wellbeing</p>
                  </div>
                </div>
              </div>
              <div class="text-center">
                <button onclick="goToPage('challengeList')"
                        class="text-white px-6 md:px-8 py-3 md:py-4 rounded-full text-lg md:text-xl font-bold transition-all transform hover:scale-105 shadow-lg"
                        style="background:linear-gradient(135deg,#7DCE82 0%,#7DBFF8 100%)">
                  Start Your Journey
                </button>
              </div>
            </div>
            ${renderNavigationBar()}
          </div>
        `;
        app.innerHTML = html;
        return;
      }

      // STATS
      if (state.currentPage === 'stats') {
        html = `
          <div class="min-h-screen bg-gradient-to-br from-pink-50 via-purple-50 to-blue-50 pb-20">
            <div class="max-w-4xl mx-auto px-4 py-8">
              <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-gray-800 mb-2">Your Progress</h1>
                <p class="text-lg text-gray-600">Track your wellbeing journey</p>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <div class="rounded-3xl shadow-xl p-8 text-white" style="background:linear-gradient(135deg,#7DCE82 0%,#7DBFF8 100%)">
                  <div class="flex items-center gap-4 mb-4">
                    <span class="text-3xl">‚úÖ</span>
                    <h2 class="text-2xl font-bold">Total Tasks</h2>
                  </div>
                  <p class="text-6xl font-bold">${state.totalTasksCompleted}</p>
                  <p class="text-lg mt-2 opacity-90">Completed</p>
                </div>
                <div class="rounded-3xl shadow-xl p-8 text-white" style="background:linear-gradient(135deg,#E0B0D5 0%,#FBBEC6 100%)">
                  <div class="flex items-center gap-4 mb-4">
                    <span class="text-3xl">üéñÔ∏è</span>
                    <h2 class="text-2xl font-bold">Total Sets</h2>
                  </div>
                  <p class="text-6xl font-bold">${state.completedChallengeNumbers.length}</p>
                  <p class="text-lg mt-2 opacity-90">Completed</p>
                </div>
              </div>
              <div class="bg-white rounded-3xl shadow-xl p-8 mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Achievements</h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                  <div class="p-4 rounded-xl text-center border-2 ${
                    state.completedChallengeNumbers.length >= 1 ? '' : 'opacity-50'
                  }" style="${
                    state.completedChallengeNumbers.length >= 1
                      ? 'background-color:#FFF8E8;border-color:#FFD07B'
                      : 'background-color:#f3f4f6;border-color:#e5e7eb'
                  }">
                    <span class="text-4xl block mb-2">üåü</span>
                    <p class="font-semibold text-sm">First Set</p>
                  </div>
                  <div class="p-4 rounded-xl text-center border-2 ${
                    state.completedChallengeNumbers.length >= 5 ? '' : 'opacity-50'
                  }" style="${
                    state.completedChallengeNumbers.length >= 5
                      ? 'background-color:#FDEEF5;border-color:#FBBEC6'
                      : 'background-color:#f3f4f6;border-color:#e5e7eb'
                  }">
                    <span class="text-4xl block mb-2">üî•</span>
                    <p class="font-semibold text-sm">5 Sets</p>
                  </div>
                  <div class="p-4 rounded-xl text-center border-2 ${
                    state.completedChallengeNumbers.length >= 12 ? '' : 'opacity-50'
                  }" style="${
                    state.completedChallengeNumbers.length >= 12
                      ? 'background-color:#E8F5FD;border-color:#7DBFF8'
                      : 'background-color:#f3f4f6;border-color:#e5e7eb'
                  }">
                    <span class="text-4xl block mb-2">üí™</span>
                    <p class="font-semibold text-sm">12 Sets</p>
                  </div>
                  <div class="p-4 rounded-xl text-center border-2 ${
                    state.totalTasksCompleted >= 100 ? '' : 'opacity-50'
                  }" style="${
                    state.totalTasksCompleted >= 100
                      ? 'background-color:#E8F7F0;border-color:#7DCE82'
                      : 'background-color:#f3f4f6;border-color:#e5e7eb'
                  }">
                    <span class="text-4xl block mb-2">üèÜ</span>
                    <p class="font-semibold text-sm">100 Tasks</p>
                  </div>
                </div>
              </div>
              <div class="text-center">
                <button onclick="goToPage('calendar')"
                        class="text-white px-8 py-4 rounded-full text-lg font-semibold transition-all transform hover:scale-105 shadow-lg flex items-center gap-2 mx-auto"
                        style="background:linear-gradient(135deg,#7DBFF8 0%,#E0B0D5 100%)">
                  <span class="text-xl">üìÖ</span>
                  View Calendar
                </button>
              </div>
            </div>
            ${renderNavigationBar()}
          </div>
        `;
        app.innerHTML = html;
        return;
      }

      // CALENDAR
      if (state.currentPage === 'calendar') {
        const monthNames = [
          'January','February','March','April','May','June',
          'July','August','September','October','November','December'
        ];
        const daysInMonth = new Date(state.calendarYear, state.calendarMonth + 1, 0).getDate();
        const firstDay = new Date(state.calendarYear, state.calendarMonth, 1).getDay();
        const today = new Date();
        const isCurrentMonth = state.calendarMonth === today.getMonth() && state.calendarYear === today.getFullYear();

        const calendarDays = [];
        for (let i = 0; i < firstDay; i++) calendarDays.push(null);
        for (let d = 1; d <= daysInMonth; d++) calendarDays.push(d);

        html = `
          <div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 pb-24">
            <div class="max-w-4xl mx-auto px-4 py-6">
              <div class="text-center mb-6">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">Daily Progress</h1>
              </div>
              <div class="bg-white rounded-3xl shadow-xl p-4 md:p-6 mb-6">
                <div class="flex items-center justify-between mb-6">
                  <button onclick="goToPreviousMonth()" class="p-2 hover:bg-gray-100 rounded-lg transition-all">
                    <span class="text-2xl">‚Üê</span>
                  </button>
                  <div class="text-center">
                    <h2 class="text-xl md:text-2xl font-bold text-gray-800">
                      ${monthNames[state.calendarMonth]} ${state.calendarYear}
                    </h2>
                    ${
                      !isCurrentMonth
                        ? '<button onclick="goToToday()" class="text-sm text-teal-600 hover:text-teal-700 mt-1">Go to Today</button>'
                        : ''
                    }
                  </div>
                  <button onclick="goToNextMonth()" class="p-2 hover:bg-gray-100 rounded-lg transition-all">
                    <span class="text-2xl">‚Üí</span>
                  </button>
                </div>
                <div class="grid grid-cols-7 gap-1 md:gap-2 mb-2">
                  ${['S','M','T','W','T','F','S'].map(d => `
                    <div class="text-center font-bold text-gray-600 text-xs md:text-sm py-2">${d}</div>
                  `).join('')}
                </div>
                <div class="grid grid-cols-7 gap-1 md:gap-2">
                  ${calendarDays.map((day, idx) => {
                    if (day === null) {
                      return '<div class="aspect-square"></div>';
                    }
                    const dateStr = new Date(state.calendarYear, state.calendarMonth, day).toDateString();
                    const progress = state.dailyProgress[dateStr];
                    const isToday = isCurrentMonth && day === today.getDate();
                    let style = '';
                    let extraClass = '';

                    if (isToday) {
                      style = 'background-color:#7DBFF8;color:white;font-weight:bold;';
                    } else if (progress) {
                      style = 'background:linear-gradient(135deg,#E8F7F0 0%,#E8F5FD 100%);';
                    } else {
                      extraClass = 'bg-gray-50';
                    }

                    return `
                      <div class="aspect-square rounded-lg p-1 md:p-2 text-center flex flex-col justify-center items-center ${extraClass}" style="${style}">
                        <div class="text-xs md:text-sm font-semibold mb-0.5">${day}</div>
                        ${
                          progress
                            ? `<div class="text-xs leading-tight">
                                 <div class="font-bold">${progress.sets} set${progress.sets !==1 ? 's' : ''}</div>
                                 <div class="text-xs opacity-75">${progress.tasks} task${progress.tasks !==1 ? 's' : ''}</div>
                               </div>`
                            : ''
                        }
                      </div>
                    `;
                  }).join('')}
                </div>
              </div>
              <div class="bg-white rounded-2xl shadow-lg p-4 md:p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4">Legend</h3>
                <div class="space-y-2">
                  <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded flex-shrink-0" style="background-color:#7DBFF8"></div>
                    <span class="text-sm md:text-base text-gray-700">Today</span>
                  </div>
                  <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded flex-shrink-0" style="background:linear-gradient(135deg,#E8F7F0 0%,#E8F5FD 100%)"></div>
                    <span class="text-sm md:text-base text-gray-700">Day with completed challenges</span>
                  </div>
                  <div class="flex items-center gap-3">
                    <div class="w-8 h-8 bg-gray-50 rounded border border-gray-200 flex-shrink-0"></div>
                    <span class="text-sm md:text-base text-gray-700">No activity</span>
                  </div>
                </div>
                <div class="mt-4 pt-4 border-t border-gray-200">
                  <p class="text-sm text-gray-600">
                    <span class="font-semibold">Numbers shown:</span> Top = Sets completed, Bottom = Tasks completed
                  </p>
                </div>
              </div>
            </div>
            ${renderNavigationBar()}
          </div>
        `;
        app.innerHTML = html;
        return;
      }

      // CHALLENGE LIST
      if (state.currentPage === 'challengeList') {
        const setsArray = Array.from({ length: state.totalSets }, (_, i) => i + 1);
        const unlockedMore =
          state.completedChallengeNumbers.length === state.totalSets - 12 &&
          state.totalSets > 12;

        html = `
          <div class="min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-yellow-50 pb-20">
            <div class="max-w-4xl mx-auto px-4 py-8">
              <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-gray-800 mb-2">Your Challenge Sets</h1>
                <p class="text-lg text-gray-600">Complete each set to unlock the next</p>
                <div class="mt-4 bg-white rounded-lg shadow-md p-4 inline-block">
                  <p class="text-xl font-semibold" style="color:#7DCE82">
                    ${state.completedChallengeNumbers.length} / ${state.totalSets} Sets Completed
                  </p>
                </div>
                ${
                  unlockedMore
                    ? `<div class="mt-4 rounded-lg shadow-lg p-4 inline-block animate-pulse text-white"
                              style="background:linear-gradient(135deg,#FFD07B 0%,#FBBEC6 100%)">
                         <p class="text-lg font-bold">üéâ 12 More Sets Unlocked! Keep Going!</p>
                       </div>`
                    : ''
                }
              </div>
              <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-8">
                ${setsArray.map(num => {
                  const isCompleted = state.completedChallengeNumbers.includes(num);
                  const isUnlocked = num === 1 || state.completedChallengeNumbers.includes(num - 1);
                  let btnClass = '';
                  let style = '';
                  if (isCompleted) {
                    btnClass = 'p-6 rounded-2xl shadow-lg text-white hover:scale-105 transition-all transform';
                    style = 'background:linear-gradient(135deg,#7DCE82 0%,#7DBFF8 100%)';
                  } else if (isUnlocked) {
                    btnClass = 'p-6 rounded-2xl shadow-lg bg-white text-gray-800 hover:shadow-xl hover:scale-105 transition-all transform';
                  } else {
                    btnClass = 'p-6 rounded-2xl shadow-lg bg-gray-200 text-gray-400 cursor-not-allowed opacity-60';
                  }
                  return `
                    <button
                      ${isUnlocked ? `onclick="startChallenge(${num})"` : ''}
                      class="${btnClass}"
                      style="${style}"
                    >
                      <div class="text-center">
                        ${
                          isCompleted
                            ? '<span class="text-3xl mb-2 block">‚úîÔ∏è</span>'
                            : (!isUnlocked ? '<span class="text-3xl mb-2 block">üîí</span>' : '')
                        }
                        <p class="text-2xl font-bold">Set ${num}</p>
                        ${
                          isCompleted
                            ? '<p class="text-sm mt-1">Completed!</p>'
                            : (!isUnlocked
                                ? `<p class="text-xs mt-1">Complete Set ${num - 1}</p>`
                                : '')
                        }
                      </div>
                    </button>
                  `;
                }).join('')}
              </div>
            </div>
            ${renderNavigationBar()}
          </div>
        `;
        app.innerHTML = html;
        return;
      }

      // PHOTO / ANSWER PAGE
      if (state.currentPage === 'photo') {
        html = `
          <div class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 py-8 px-4 pb-20">
            <div class="max-w-3xl mx-auto">
              <button onclick="goToPage('challenges')"
                      class="hover:text-gray-800 mb-6 inline-flex items-center gap-2 bg-white px-4 py-2 rounded-lg shadow-md hover:shadow-lg transition-all"
                      style="color:#7DBFF8">
                ‚Üê Back to Set ${state.currentChallengeNumber || ''}
              </button>
              <div class="text-center mb-6">
                <h1 class="text-3xl font-bold text-gray-800 mb-4">Plot Your Coordinates</h1>
                <p class="text-lg text-gray-600 mb-2">Use the coordinates below to mark squares on grid paper</p>
                <p class="text-md text-gray-500">Use coloured pencils, markers, or crayons to fill in each square</p>
              </div>
              <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
                <h3 class="text-xl font-bold text-gray-800 mb-4">üìç Mark These Coordinates:</h3>
                <p class="text-sm text-gray-600 mb-4">On your grid paper, colour in these squares with the specified colours:</p>
                <div class="space-y-4">
                  <div class="p-4 rounded-lg" style="background-color:#FDEEF5">
                    <p class="font-bold text-gray-800 mb-2 flex items-center gap-2">
                      <span class="w-4 h-4 rounded" style="background-color:#FF1493"></span>
                      Dark Pink Squares:
                    </p>
                    <p class="text-gray-700 leading-relaxed">${state.pixelArtCoords.darkPink}</p>
                  </div>
                  <div class="p-4 rounded-lg" style="background-color:#FFF0F5">
                    <p class="font-bold text-gray-800 mb-2 flex items-center gap-2">
                      <span class="w-4 h-4 rounded" style="background-color:#FFB6C1"></span>
                      Light Pink Squares:
                    </p>
                    <p class="text-gray-700 leading-relaxed">${state.pixelArtCoords.lightPink}</p>
                  </div>
                  <div class="p-4 rounded-lg" style="background-color:#F5F5F5">
                    <p class="font-bold text-gray-800 mb-2 flex items-center gap-2">
                      <span class="w-4 h-4 rounded bg-black"></span>
                      Black Squares:
                    </p>
                    <p class="text-gray-700 leading-relaxed">${state.pixelArtCoords.black}</p>
                  </div>
                </div>
              </div>

              <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
                <h3 class="text-xl font-bold text-gray-800 mb-4">‚úèÔ∏è What did you create?</h3>
                <p class="text-sm text-gray-600 mb-4">
                  After plotting the coordinates, what picture or pattern did you see? Type the answer below:
                </p>
                <input id="userWord" type="text"
                       placeholder="Enter your answer..."
                       class="w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg focus:outline-none focus:border-purple-400 transition-all" />
                <p id="wordFeedback" class="text-sm mt-2"></p>
              </div>

              <div class="text-center">
                <button onclick="completeSetFromPhoto()"
                        class="px-8 py-4 rounded-full text-lg font-bold transition-all transform text-white shadow-lg hover:scale-105"
                        style="background:linear-gradient(135deg,#7DCE82 0%,#7DBFF8 100%)">
                  ‚úì Complete Set
                </button>
              </div>
            </div>
          </div>
        `;
        app.innerHTML = html;
        return;
      }

      // CHALLENGES PAGE (default fall-through)
      const totalCompleted = getTotalCompleted();
      html = `
        <div class="min-h-screen bg-gradient-to-br from-blue-50 via-green-50 to-pink-50 py-8 px-4 pb-20">
          <div class="max-w-3xl mx-auto">
            <button onclick="goToPage('challengeList')"
                    class="hover:text-gray-800 mb-6 inline-flex items-center gap-2 bg-white px-4 py-2 rounded-lg shadow-md hover:shadow-lg transition-all"
                    style="color:#7DBFF8">
              ‚Üê Back to Challenge Sets
            </button>
            <div class="text-center mb-8">
              <h1 class="text-4xl font-bold text-gray-800 mb-2">Set ${state.currentChallengeNumber || ''}</h1>
              <p class="text-lg text-gray-600 mb-4">Complete these 5 wellbeing tasks</p>
              <div class="bg-white rounded-lg shadow-md p-4 inline-block">
                <p class="text-2xl font-bold text-gray-800">
                  ${totalCompleted} <span class="text-gray-500 text-lg">/ 5 completed</span>
                </p>
              </div>
            </div>
            <div class="space-y-4 mb-8">
              ${
                state.dailyChallenges.map((ch, idx) => {
                  const done = !!state.completedChallenges[idx];
                  return `
                    <button onclick="toggleChallenge(${idx})"
                            class="w-full text-left rounded-xl shadow-lg overflow-hidden transition-all transform hover:scale-[1.02] border-2 ${done ? '' : 'bg-white'}"
                            style="${done ? 'background-color:#E8F7F0;border-color:#7DCE82' : 'border-color:#e5e7eb'}">
                      <div class="p-5">
                        <div class="flex items-center gap-4">
                          <div class="w-8 h-8 rounded-full border-2 flex items-center justify-center flex-shrink-0 ${done ? 'border-0' : 'border-gray-300 bg-white'}"
                               style="${done ? 'background-color:#7DCE82' : ''}">
                            ${done ? '<span class="text-white text-lg">‚úì</span>' : ''}
                          </div>
                          <span class="text-lg ${done ? 'text-gray-500 line-through' : 'text-gray-800'}">
                            ${ch}
                          </span>
                        </div>
                      </div>
                    </button>
                  `;
                }).join('') || '<p class="text-center text-gray-500">No challenges yet. Go back and pick a set.</p>'
              }
            </div>
            <div class="text-center">
              <button onclick="goToPhotoPage()"
                      ${totalCompleted === 5 ? '' : 'disabled'}
                      class="px-8 py-4 rounded-full text-lg font-bold transition-all transform text-white ${totalCompleted === 5 ? 'shadow-lg hover:scale-105' : 'bg-gray-300 cursor-not-allowed'}"
                      style="${totalCompleted === 5 ? 'background:linear-gradient(135deg,#7DCE82 0%,#7DBFF8 100%)' : ''}">
                ${totalCompleted === 5 ? 'üì∏ Capture Your Balance!' : 'üîí Complete All 5 Challenges to Continue'}
              </button>
            </div>
          </div>
          ${renderNavigationBar()}
        </div>
      `;
      app.innerHTML = html;
    }

    // Expose functions globally for inline onclick
    window.goToPage = goToPage;
    window.saveEmailAndContinue = saveEmailAndContinue;
    window.skipEmailAndContinue = skipEmailAndContinue;
    window.startChallenge = startChallenge;
    window.toggleChallenge = toggleChallenge;
    window.goToPhotoPage = goToPhotoPage;
    window.completeSetFromPhoto = completeSetFromPhoto;
    window.goToPreviousMonth = goToPreviousMonth;
    window.goToNextMonth = goToNextMonth;
    window.goToToday = goToToday;

    // Initial render
    render();
  </script>
</body>
</html>
